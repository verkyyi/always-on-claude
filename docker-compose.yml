services:
  dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: claude-dev
    hostname: claude-dev
    stdin_open: true
    tty: true
    volumes:
      # Claude Code config/auth/history (bind mount to persist through down/up)
      - ~/.claude:/home/dev/.claude

      # Claude Code onboarding state — lives OUTSIDE ~/.claude/
      # Without this, every down/up triggers full re-onboarding
      # IMPORTANT: run `touch ~/.claude.json` on host before first start
      - ~/.claude.json:/home/dev/.claude.json

      # Git config
      - ~/.gitconfig.d:/home/dev/.gitconfig.d

      # Your projects — bind mount so files are visible directly on the host
      # Create ~/projects on the host before first start
      - ~/projects:/home/dev/projects

      # SSH keys for GitHub (read-only)
      - ~/.ssh:/home/dev/.ssh:ro

      # Dev-env scripts (overnight tasks, load-secrets, etc.)
      - ~/dev-env:/home/dev/dev-env:ro

    environment:
      # AWS region (credentials come from EC2 instance role via metadata)
      - AWS_DEFAULT_REGION=us-east-1
      - NODE_ENV=development

    # Required: allows access to EC2 instance metadata for IAM role
    network_mode: host

    restart: unless-stopped
